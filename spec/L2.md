<!-- spec/L2.md -->
# ExpenseFlow
ExpenseFlow は「経費申請 → 承認 → 支払」のワークフローを持つ小さな業務アプリです。

## 目的（ざっくり）
経費申請を「作る → 出す → 承認する → 支払済みにする」まで、Webで回せるようにしたい。

## やりたいこと
- ログインっぽいものがあって、自分の画面に入れる
- 経費申請を作れる（明細を何件か入れられる）
- 申請を提出できる
- 承認者が承認/却下/差戻しできる
- 経理が支払済みにできる
- 一覧で見られる（自分の申請、承認待ち、支払待ち、みたいな）

## ユーザーストーリー
- 申請者として、経費申請を作って提出したい
- 承認者として、提出された申請を承認/却下/差戻ししたい
- 申請者として、差戻しされたら直して再提出したい
- 経理として、承認済みの申請を支払済みにしたい
- 関係者として、申請を一覧で確認したい

## アーキテクチャ
- Next.js + TypeScript を用いて、フロントエンドの各ページと合わせて、APIも実装すること
- サーバーサイドレンダリング（SSR）を用いて実装することとし、SPA的な実装は避けること
- データベースには SQLite を使用すること

## ユーザーのロールの定義
- Employee（申請者）
- Approver（承認者）
- Accounting（経理）特権ロール

## 申請の状態について
以下のような状態を持つこととする
- DRAFT：下書き
- SUBMITTED：提出済み
- CHANGES_REQUESTED：差戻し（修正依頼）
- APPROVED：承認済み
- REJECTED：却下
- PAID：支払済み

また、以下のように状態遷移をすることとする
- DRAFT → SUBMITTED
- SUBMITTED → CHANGES_REQUESTED / APPROVED / REJECTED
- CHANGES_REQUESTED → SUBMITTED（再提出）
- APPROVED → PAID

## 権限など
- Employee は自分の申請を作成・編集・提出できる
- Approver は自分に割り当てられた申請を承認・却下・差戻しできる
- Accounting は承認済みの申請を支払済みにできる
- 各ユーザーは自分の申請の一覧を見られる
- Approver は自分に割り当てられた申請の一覧を見られる
- Accounting はすべての承認済み申請の一覧を見られる
- Accounting はログを確認できる

## データベース
以下のようなテーブルを持って管理すること
- Users（ユーザー情報、ロールなど）
- Items（経費申請情報、状態など）
- Logs（状態遷移の履歴など）

## ログイン機能
- 簡易的なログイン機能を実装する。ユーザー名とパスワードで認証し、ロールに応じた画面に遷移するものとする。
- ユーザー登録は事前にデータベースに登録しておくものとする
- パスワードは平文で保存せず、適切にハッシュ化して保存すること

## UI/UX
- 各画面はビジネス用途であることを考慮し、シンプルで使いやすいデザインとする
- フォームの入力チェックやエラーメッセージの表示など、ユーザーフレンドリーなインターフェースを提供すること
- 入力フォームには、`role` と `name` 属性を適切に設定し、アクセシビリティと、テスト自動化時に要素を特定しやすくすること
